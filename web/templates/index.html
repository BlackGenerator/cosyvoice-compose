<!-- web/templates/index.html -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>CosyVoice Web - Flask ç‰ˆ</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 20px auto; }
        textarea { width: 100%; height: 80px; }
        button { padding: 8px 16px; margin: 5px 0; }
        audio { width: 100%; margin: 10px 0; }
        .status { padding: 8px; margin: 10px 0; border-radius: 4px; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h2>ğŸ™ï¸ CosyVoice Web (Flask API + å‰ç«¯)</h2>
    <textarea id="text" placeholder="è¾“å…¥æ–‡æœ¬">ä½ å¥½ï¼Œæ¬¢è¿ä½¿ç”¨ CosyVoiceï¼</textarea><br>
    <select id="voice">
        <option value="ä¸­æ–‡å¥³">ä¸­æ–‡å¥³</option>
        <option value="ä¸­æ–‡ç”·">ä¸­æ–‡ç”·</option>
        <option value="è‹±æ–‡å¥³">è‹±æ–‡å¥³</option>
        <option value="è‹±æ–‡ç”·">è‹±æ–‡ç”·</option>
        <option value="æ—¥è¯­ç”·">æ—¥è¯­ç”·</option>
        <option value="éŸ©è¯­å¥³">éŸ©è¯­å¥³</option>
        <option value="ç²¤è¯­å¥³">ç²¤è¯­å¥³</option>
    </select>
    <button onclick="synthesize()">ğŸ”Š ç”Ÿæˆè¯­éŸ³</button>
    <div id="status"></div>
    <audio id="player" controls style="display:none;"></audio>

    <script>
        async function synthesize() {
            const text = document.getElementById('text').value;
            const voice = document.getElementById('voice').value;
            const status = document.getElementById('status');
            const player = document.getElementById('player');

            status.className = 'status';
            status.textContent = 'åˆæˆä¸­...';

            try {
                const res = await fetch('/tts', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({text, voice})
                });
                const data = await res.json();
                if (data.error) throw new Error(data.error);

                player.src = data.audio_url + '?t=' + Date.now();
                player.style.display = 'block';
                status.textContent = 'âœ… åˆæˆæˆåŠŸï¼';
                status.className = 'status';
            } catch (e) {
                status.textContent = 'âŒ ' + e.message;
                status.className = 'status error';
            }
        }
    </script>
</body>
</html>