<!-- web/templates/index.html -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>CosyVoice Web - Flask 版</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 20px auto; }
        textarea { width: 100%; height: 80px; }
        button { padding: 8px 16px; margin: 5px 0; }
        audio { width: 100%; margin: 10px 0; }
        .status { padding: 8px; margin: 10px 0; border-radius: 4px; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h2>🎙️ CosyVoice Web (Flask API + 前端)</h2>
    <textarea id="text" placeholder="输入文本">你好，欢迎使用 CosyVoice！</textarea><br>
    <select id="voice">
        <option value="中文女">中文女</option>
        <option value="中文男">中文男</option>
        <option value="英文女">英文女</option>
        <option value="英文男">英文男</option>
        <option value="日语男">日语男</option>
        <option value="韩语女">韩语女</option>
        <option value="粤语女">粤语女</option>
    </select>
    <button onclick="synthesize()">🔊 生成语音</button>
    <div id="status"></div>
    <audio id="player" controls style="display:none;"></audio>

    <script>
        async function synthesize() {
            const text = document.getElementById('text').value;
            const voice = document.getElementById('voice').value;
            const status = document.getElementById('status');
            const player = document.getElementById('player');

            status.className = 'status';
            status.textContent = '合成中...';

            try {
                const res = await fetch('/tts', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({text, voice})
                });
                const data = await res.json();
                if (data.error) throw new Error(data.error);

                player.src = data.audio_url + '?t=' + Date.now();
                player.style.display = 'block';
                status.textContent = '✅ 合成成功！';
                status.className = 'status';
            } catch (e) {
                status.textContent = '❌ ' + e.message;
                status.className = 'status error';
            }
        }
    </script>
</body>
</html>